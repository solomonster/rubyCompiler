PROGRAM         : COMPSTMT

COMPSTMT        : STMTS OPT_TERMS

STMTS           : NONE
                | STMT
                | STMTS TERMS STMT

OPT_TERMS       : 
                | TERMS

TERMS           : TERM
                | TERMS ';'

TERM            : ";"
                | "\n" 

STMT            : CALL  
                | STMT if EXPR
                | STMT while EXPR
                | EXPR


EXPR            : return CALL_ARGS
                | EXPR and EXPR
                | EXPR or EXPR
                | not EXPR
                | COMMAND             // method calls  without parenthesis
                | ! COMMAND
                | ARG
               

CALL            : FUNCTION
                | COMMAND
               

COMMAND         : IDENTIFIER CALL_ARGS
                | PRIMARY.IDENTIFIER CALL_ARGS   


FUNCTION        : IDENTIFIER 
                | IDENTIFIER "(" CALL_ARGS")"
                | IDENTIFIER "(" ")"
                | for BLOCK_VAR in EXPR DO   
                    COMPSTMT
                  end
                | def FNAME ARGDECL       
                    COMPSTMT
                  end

THEN            : TERM 
                | then 
                | TERM then 

DO              : TERM 
                | do 
                | TERM do


BLOCK_VAR       : LHS 

LHS             : VARIABLE                    
                | PRIMARY "[" "]"
                | PRIMARY "["ARGS"]"


CALL_ARGS       : ARGS
                | COMMAND

ARGS            :ARG
                |ARG COMMA_ARG_LIST

COMMA_ARG_LIST  :,ARG
                | ,ARG COMMA_ARG_LIST

ARG             : LHS = ARG
                | ARG '..' ARG
                | ARG '...' ARG
                | ARG + ARG | ARG - ARG | ARG * ARG | ARG / ARG
                | + ARG | - ARG
                | ARG > ARG | ARG >= ARG | ARG < ARG | ARG <= ARG
                | ARG == ARG | ARG != ARG
                | ! ARG
                | ARG && ARG | ARG || ARG
                | PRIMARY


PRIMARY         : "(" COMPSTMT ")"         
                | LITERAL            
                | VARIABLE               
                |PRIMARY "[" "]"
                |PRIMARY "[" ARGS "]"   
                |"[" "]"
                |"["ARGS"]"
                | return 
                | FUNCTION
                | if EXPR THEN     
                    COMPSTMT
                  {elsif EXPR THEN
                    COMPSTMT}
                  [else
                    COMPSTMT]
                  end
                | while EXPR DO COMPSTMT end


ARGDECL         : "(" ARGLIST ")"       
                | ARGLIST TERM


ARGLIST        :IDENTIFIER
               |ARGLIST,IDENTIFIER 


VARIABLE        : VARNAME


LITERAL         : numeric-literal 
                | STRING-LITERAL


FNAME           : IDENTIFIER | ".."| "|" | & | <=> | == 
                | > | >= | < | + | - | * | / 

VARNAME         : IDENTIFIER

STRING-LITERAL  : STRING


                




